<html lang="en">
    <head>
        <script src="/jquery-2.0.3.min.js"></script>
        <script src="/pengines.js"></script>
        <script type="text/x-prolog">

            main :-
                rits:rits_start(S0),
                rits:rits_next_action(solve(1/2+3/4),A,S0,S1),
                interact(A, S1).

            interact(A, S) :-
                (    interact_(A, S) -> true
                ;    term_to_atom(A, Atom),
                     pengine_output(Atom)
                ).

            interact_(format(F,Args), S0) :-
                term_to_atom(F-Args, Action),
                pengine_output(Action),
                rits:rits_next_action(next, A, S0, S),
                interact(A, S).
            interact_(format(F), S0) :-
                term_to_atom(F, Atom),
                %format(atom(Atom), F, []), % TODO: make this work
                pengine_output(Atom),
                rits:rits_next_action(next, A, S0, S),
                interact(A, S).
            interact_(fraction_layout(F), S0) :-
                term_to_atom(F, Action),
                pengine_output(Action),
                rits:rits_next_action(next, A, S0, S),
                interact(A, S).
            interact_(read_answer, S0) :-
                pengine_input('Please answer: ', Input),
                (    Input == stop -> true
                ;    rits:rits_next_action(student_answers(Input), A, S0, S),
                     interact(A, S)
                ).
            interact_(enter, S0) :-
                rits:rits_next_action(next, A, S0, S),
                interact(A, S).
            interact_(exit, S0) :-
                rits:rits_next_action(next, A, S0, S),
                interact(A, S).
            interact_(solve(T), S0) :-
                rits:rits_next_action(solve(T), A, S0, S),
                interact(A, S).

        </script>
        <script>
            var pengine = new Pengine({
                oncreate: handleCreate,
                onprompt: handlePrompt,
                onoutput: handleOutput
            });
            function handleCreate() {
                pengine.ask('main');
            }
            function handlePrompt() {
                pengine.respond(prompt(this.data));
            }
            function handleOutput() {
                $('#out').append(this.data).append("<br><br>");
            }
        </script>
    </head>
    <body>
        <div id="out"></div>
    </body>
</html>
